<!DOCTYPE html>
<html>
  <head>
    <title>Collab Code Editor</title>
    <style>
      body { margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; }
      #editor { flex: 1; border: 1px solid #ddd; }
      #controls { padding: 10px; background: #f4f4f4; display: flex; gap: 10px; }
      #output { background: #222; color: #0f0; padding: 10px; height: 150px; overflow: auto; }
    </style>
  </head>
  <body>
    <div id="controls">
      <select id="language">
        <option value="71">Python 3</option>
        <option value="62">Java</option>
        <option value="54">C++</option>
        <option value="63">JavaScript (Node.js)</option>
      </select>
      <button id="runBtn">Run Code</button>
    </div>
    <div id="editor"></div>
    <pre id="output">Output will appear here...</pre>

    <!-- Monaco Editor CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

    <script>
      const socket = io("http://localhost:5010");

      let editor;

      // Load Monaco
      require.config({ paths: { vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs" }});
      require(["vs/editor/editor.main"], () => {
        editor = monaco.editor.create(document.getElementById("editor"), {
          value: "print('Hello from Collab Editor!')",
          language: "python",
          theme: "vs-dark",
          automaticLayout: true,
        });

        // Sync code in real time
        editor.onDidChangeModelContent(() => {
          const code = editor.getValue();
          socket.emit("codeChange", { roomName: "demo-room", code });
        });
      });

      // Ask username & join room
      const username = prompt("Enter your name:");
      socket.emit("joinRoom", { roomName: "demo-room", username });

      // Update editor when others type
      socket.on("codeUpdate", (code) => {
        if (editor && editor.getValue() !== code) {
          editor.setValue(code);
        }
      });

      // Run button click
      document.getElementById("runBtn").addEventListener("click", () => {
        const language_id = document.getElementById("language").value;
        socket.emit("runCode", {
          roomName: "demo-room",
          language_id,
          source_code: editor.getValue(),
        });
      });

      // Show output
      socket.on("codeResult", (result) => {
        document.getElementById("output").textContent = 
          result.stdout || result.stderr || JSON.stringify(result, null, 2);
      });

      socket.on("error", (err) => alert("‚ùå " + err.message));
    </script>
  </body>
</html>